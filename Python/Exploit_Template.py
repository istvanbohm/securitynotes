#!/usr/bin/python
# -*- coding: utf-8 -*-
import argparse
import os
import requests
import time
import urllib3  # ignore InsecureRequestWarning

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning) # ignore InsecureRequestWarning
proxies = {
  "http"  : "http://127.0.0.1:8080",
  "https" : "http://127.0.0.1:8080"
}
args = None


def requests_poc(url):
    session = requests.session()
    if args.proxy:
        session.proxies.update(proxies)

    # Login and set cookies
    headers={'user-agent': 'exploit/0.0.1'}
    data = {'username':'admin', 'password':'l33t' }
    res = session.post(url + "/login", headers=headers, data=data,allow_redirects=True, verify=False)

    # Get Pagge
    headers={'user-agent': 'exploit/0.0.1'}
    startTime = time.time()
    res = session.get(url + "/profile", headers=headers, verify=False)
    elapsedTime = time.time() - startTime
    content_length = int(res.headers['Content-Length'])
    print("Reponse: {}".format(res.text))
    print("Content-Length: {}".format(content_length))
    print("Elapsed time: {}".format(elapsedTime))


def main():
    global args
    parser = argparse.ArgumentParser()
    parser.add_argument('--target','-t', help='The URL of the target server',required=True)
    parser.add_argument('--lhost','-lh', help="The IP address of the reverse shell")
    parser.add_argument('--lport','-lp', type=int, help="The port of the reverse shell")
    parser.add_argument('--proxy', default=False, help="You the proxy listening on 127.0.0.1:8080", action='store_true')
    args = parser.parse_args()
    requests_poc(args.target)


if __name__ == '__main__':
    main()
